<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"> <title>RRT</title>
</head>

<body style="font-family:sans-serif; font-size:15px; width:600px; margin-left:auto; margin-right:auto; background-color:#e0e0e0;">

<div style="width:500px; margin-left:auto; margin-right:auto;"> 
<!-- <img src="NewtonDrawing.jpg" width="500" height="500"> -->

<canvas id="theCanvas" width="500" height="500">
           Canvas not supported; please update your browser.
</canvas>

</div>

<script>

	var obs = [];
	obs.push(2);
	obs.push(5);
	obs.push(2);

	var test = [];
	test.push(2);
	test.push(2);

	var dest = [];
	dest.push(2);
	dest.push(8);
	//document.write(obs);

	//document.write(clear(obs, test));

	document.write(link(obs, test, dest));

	// 
	function link(obstacles, testP, destP){
		
		// Check if start point is in collision
		if (clear(obstacles, testP) == false){
			return false;
		}

		var testX = testP[0];
		var testY = testP[1];
		var destX = destP[0];
		var destY = destP[1];
		var yincr = 0, xincr = 0;

		if (destY != testY && destX != testX){
			var slope = (destY - testY) / (destX - testX);
			yincr = Math.sqrt((Math.pow(slope,2)) / (Math.pow(slope,2) + 1));
			xincr = (1 / slope) * yincr;
		}

		// Apply distance formula
		var dist = Math.sqrt(Math.pow((destX - testX), 2) + Math.pow((destY - testY), 2));

		var numIter = Math.floor(dist);

		var newX = testX, newY = testY;

		//document.write(numIter);

		/* Go in increments of 1 unit towards the destination point,
		   checking each subsequent point for collision with an 
		   obstacle.*/
		for (var i = 0; i < numIter; i++){
			//document.write('i: ', i);

			// Check if dest and start are the same. If so, break
			if (destY == testY && destX == testX){
				//document.write('in equals')
				break;
			}
			
			// Check different configurations of the start and end
			// points and increment accordingly
			if (destY > testY && destX > testX){
				newX = newX + xincr;
				newY = newY + yincr;
			}
			
			else if (destY > testY && destX < testX){
				newX = newX - xincr;
				newY = newY + yincr;
			}
			
			else if (destY < testY && destX < testX){
				newX = newX - xincr;
				newY = newY - yincr;
			}
			
			else if (destY < testY && destX > testX){
				newX = newX + xincr;
				newY = newY - yincr;
			}
			
			else if (destY == testY && destX > testX){
				newX = newX + 1;
				newY = newY;
			}
			
			else if (destY == testY && destX < testX){
				newX = newX - 1;
				newY = newY;
			}
			
			else if (destX == testX && destY > testY){
				newX = newX;
				newY = newY + 1;
			}
			
			else if (destX == testX && destY < testY){
				newX = newX;
				newY = newY - 1;
			}

			//document.write('newX: ', newX, ' newY: ', newY, 'i: ', i);

			// Check for collision of new point with obstacle
			newPoint = [];
			newPoint.push(newX);
			newPoint.push(newY);
			if (clear(obstacles, newPoint) == false){
				return false;
			}

		}

		return true;
	}

	function clear(obstacles, testP){

		// Determine number of obstacles
		var numObstacles = obstacles.length / 3;
		//document.write(numObs);

		var nextIndex = 0;	// Index of obstacle list

		// Get the starting point coordinates
		var testX = testP[0];
		var testY = testP[1];

		// Loop through all obstacles
		for (var i = 0; i < numObstacles; i++){
			// Extract each obstacle's X/Y coordinates and radius
			var obsX = obstacles[nextIndex++];
			var obsY = obstacles[nextIndex++];
			var obsR = obstacles[nextIndex++];

			// Apply distance formula
			var dist = Math.sqrt(Math.pow(obsX - testX, 2) + Math.pow((obsY - testY), 2));

			if (dist <= obsR){
				return false;
			}
		}

		return true;
	}

</script>


</body>

</html>